{"version":3,"file":"editable-outline.umd.js","sources":["editable-outline.umd.js"],"sourcesContent":["/**\n * Copyright 2019 The Pennsylvania State University\n * @license Apache-2.0, see License.md for full text.\n */\nimport { LitElement, html, css } from \"lit-element/lit-element.js\";\nimport { getRange } from \"@lrnwebcomponents/utils/utils.js\";\nimport \"@polymer/iron-a11y-keys/iron-a11y-keys.js\";\nimport \"@lrnwebcomponents/json-outline-schema/json-outline-schema.js\";\n/**\n * `editable-outline`\n * `a simple outline thats contenteditable in nature`\n * @demo demo/index.html\n * @element editable-outline\n */\nclass EditableOutline extends LitElement {\n  \n  //styles function\n  static get styles() {\n    return  [\n      \n      css`\n:host {\n  display: block;\n  font-family: 'Noto Serif', serif;\n}\n\n:host([hidden]) {\n  display: none;\n}\n\n.button-wrapper {\n  line-height: 36px;\n  position: -webkit-sticky;\n  position: sticky;\n  top: 0px;\n  background-color: white;\n  display: block;\n  justify-content: space-evenly;\n}\n@media (max-width: 1000px) {\n  button span {\n    opacity: 0;\n    visibility: hidden;\n    position: absolute;\n    left: -9999px;\n  }\n}\nbutton {\n  height: 32px;\n  font-size: 10px;\n  margin: 0;\n  padding: 0 8px;\n}\n\nbutton span {\n  padding-left: 4px;\n  pointer-events: none;\n}\n\n#outline {\n  margin: 0;\n}\nul {\n  font-size: 16px;\n  line-height: 32px;\n  padding-left: 32px;\n  visibility: visible;\n  opacity: 1;\n  overflow: hidden;\n  height: auto;\n  transition: .2s ease-in-out all;\n}\nli {\n  font-size: 16px;\n  line-height: 32px;\n  padding: 4px;\n  transition: .2s linear all;\n}\nul:hover {\n  outline: 1px solid #EEEEEE;\n}\nli.collapsed-title {\n  background-color: #dddddd;\n}\nli.collapsed-title:after {\n  content:\"    ( Double-click to expand )\";\n}\nli:after {\n  transition: .4s ease-in-out all;\n  opacity: 0;\n  font-size: 11px;\n  visibility: hidden;\n}\nli.collapsed-title:hover:after {\n  font-style: italic;\n  opacity: 1;\n  visibility: visible;\n}\nul.collapsed-content {\n  visibility: hidden;\n  opacity: 0;\n  height: 0;\n}\nli:focus,\nli:active,\nli:hover {\n  background-color: #EEEEEE;\n  outline: 1px solid #CCCCCC;\n}\n\niron-icon {\n  pointer-events: none;\n}\n      `\n    ];\n  }\n  // render function\n  render() {\n    return html`\n\n<iron-a11y-keys keys=\"enter\" @keys-pressed=\"${this._enterPressed}\"\n  stop-keyboard-event-propagation></iron-a11y-keys>\n<iron-a11y-keys keys=\"up\" @keys-pressed=\"${this._upPressed}\"\n  stop-keyboard-event-propagation></iron-a11y-keys>\n<iron-a11y-keys keys=\"down\" @keys-pressed=\"${this._downPressed}\"\n  stop-keyboard-event-propagation></iron-a11y-keys>\n<div class=\"button-wrapper\">\n<button @click=\"${this.buttonEvents}\" id=\"add\" title=\"Add a new node\">\n  <iron-icon icon=\"icons:add\"></iron-icon><span>Add</span>\n</button>\n<button @click=\"${this.buttonEvents}\" id=\"collapse\" title=\"Toggle active node collapsed status\">\n  <iron-icon icon=\"icons:swap-vert\"></iron-icon><span>Toggle active</span>\n</button>\n<button @click=\"${this.buttonEvents}\" id=\"collapseall\" title=\"Collapse all nodes\">\n  <iron-icon icon=\"icons:swap-vert\"></iron-icon><span>Collapse all</span>\n</button>\n<button @click=\"${this.buttonEvents}\" id=\"expandall\" title=\"Expand all nodes\">\n  <iron-icon icon=\"icons:swap-vert\"></iron-icon><span>Expand all</span>\n</button>\n<button @click=\"${this.buttonEvents}\" id=\"down\" title=\"Move active node down\">\n  <iron-icon icon=\"icons:arrow-downward\"></iron-icon><span>Move down</span>\n</button>\n<button @click=\"${this.buttonEvents}\" id=\"up\" title=\"Move active node up\">\n  <iron-icon icon=\"icons:arrow-upward\"></iron-icon><span>Move up</span>\n</button>\n<button @click=\"${this.buttonEvents}\" id=\"outdent\" title=\"Outdent active node\">\n  <iron-icon icon=\"editor:format-indent-decrease\"></iron-icon><span>Outdent</span>\n</button>\n<button @click=\"${this.buttonEvents}\" id=\"indent\" title=\"Indent active node\">\n  <iron-icon icon=\"editor:format-indent-increase\"></iron-icon><span>Indent</span>\n</button>\n<button @click=\"${this.buttonEvents}\" id=\"duplicate\" title=\"Duplicate active node tree\">\n  <iron-icon icon=\"icons:content-copy\"></iron-icon><span>Duplicate</span>\n</button>\n</div>\n<ul id=\"outline\"></ul>`;\n  }\n\n  // properties available to the custom element for data binding\n    static get properties() {\n    return {\n  \n  ...super.properties,\n  \n  /**\n   * A items list of JSON Outline Schema Items\n   */\n  \"items\": {\n    \"type\": Array\n  },\n  /**\n   * Edit mode\n   */\n  \"editMode\": {\n    \"type\": Boolean,\n    \"attribute\": \"edit-mode\"\n  },\n  /**\n   * Outline node for keyboard key binding\n   */\n  \"__outlineNode\": {\n    \"type\": Object\n  }\n}\n;\n  }\n  constructor() {\n    super();\n    this.items = [];\n    this.editMode = false;\n    this.jos = window.JSONOutlineSchema.requestAvailability();\n    import(\"@polymer/iron-icon/iron-icon.js\");\n    import(\"@polymer/iron-icons/iron-icons.js\");\n    import(\"@polymer/iron-icons/editor-icons.js\");\n    setTimeout(() => {\n      this.addEventListener(\"dblclick\", this._collapseClickHandler.bind(this));\n    }, 0);\n  }\n  /**\n   * Store the tag name to make it easier to obtain directly.\n   * @notice function name must be here for tooling to operate correctly\n   */\n  static get tag() {\n    return \"editable-outline\";\n  }\n  /**\n   * Collapse button callback\n   */\n  _collapse(e) {\n    let node = this.getSelectionNode();\n    if (\n      node &&\n      node.tagName === \"LI\" &&\n      node.nextElementSibling &&\n      node.nextElementSibling.tagName === \"UL\"\n    ) {\n      node.classList.toggle(\"collapsed-title\");\n      node.nextElementSibling.classList.toggle(\"collapsed-content\");\n    }\n  }\n  /**\n   * Expand all items\n   */\n  _expandall(e) {\n    this.shadowRoot.querySelectorAll(\"li\").forEach(el => {\n      el.classList.remove(\"collapsed-title\");\n    });\n    this.shadowRoot.querySelectorAll(\"ul\").forEach(el => {\n      el.classList.remove(\"collapsed-content\");\n    });\n  }\n  /**\n   * Collapse all items\n   */\n  _collapseall(e) {\n    this.shadowRoot.querySelectorAll(\"li\").forEach(el => {\n      if (el.nextElementSibling && el.nextElementSibling.tagName === \"UL\") {\n        el.classList.add(\"collapsed-title\");\n        el.nextElementSibling.classList.add(\"collapsed-content\");\n      }\n    });\n  }\n  _onKeyDown(e) {\n    if (this.editMode) {\n      switch (e.key) {\n        case \"Tab\":\n          if (e.shiftKey) {\n            this._tabBackKeyPressed(e);\n          } else {\n            this._tabKeyPressed(e);\n          }\n          break;\n      }\n    }\n  }\n  /**\n   * Click handler method needs to walk a little different then normal collapse\n   */\n  _collapseClickHandler(e) {\n    let el;\n    let i = 0;\n    let notFound = true;\n    while (notFound && e.path.length > i + 1) {\n      el = e.path[i];\n      if (\n        el.tagName === \"LI\" &&\n        el.nextElementSibling &&\n        el.nextElementSibling.tagName === \"UL\"\n      ) {\n        el.classList.toggle(\"collapsed-title\");\n        el.nextElementSibling.classList.toggle(\"collapsed-content\");\n        notFound = false;\n      }\n      i++;\n    }\n  }\n  firstUpdated() {\n    this.__outlineNode = this.shadowRoot.querySelector(\"#outline\");\n    this.shadowRoot.querySelectorAll(\"iron-a11y-keys\").forEach(el => {\n      el.target = this.__outlineNode;\n    });\n    this.__outlineNode.addEventListener(\"keydown\", this._onKeyDown.bind(this));\n    this._observer = new MutationObserver(this._observeRecord.bind(this));\n    this._observer.observe(this.__outlineNode, {\n      childList: true,\n      subtree: true\n    });\n  }\n  updated(changedProperties) {\n    changedProperties.forEach((oldValue, propName) => {\n      let notifiedProps = [\"editMode\", \"items\"];\n      if (notifiedProps.includes(propName)) {\n        // notify\n        let eventName = `${propName\n          .replace(/([a-z0-9]|(?=[A-Z]))([A-Z])/g, \"$1-$2\")\n          .toLowerCase()}-changed`;\n        this.dispatchEvent(\n          new CustomEvent(eventName, {\n            detail: {\n              value: this[propName]\n            }\n          })\n        );\n      }\n    });\n  }\n  /**\n   * Mutation observer callback\n   * @todo current issue if you copy and paste into the same node\n   */\n  _observeRecord(record) {\n    for (var index in record) {\n      let info = record[index];\n      // if we've got new nodes to react to that were not imported\n      if (info.addedNodes.length > 0) {\n        // special rules for an outdent event\n        for (let i in info.addedNodes) {\n          if (info.addedNodes[i].tagName) {\n            if (info.addedNodes[i].tagName === \"LI\") {\n              if (this.__blockScrub) {\n                info.addedNodes[i].setAttribute(\"contenteditable\", \"true\");\n              } else {\n                this.jos.scrubElementJOSData(info.addedNodes[i]);\n                info.addedNodes[i].setAttribute(\"contenteditable\", \"true\");\n              }\n            }\n            // we have an unknown hest of items, scrub em all if we are in scrub mode\n            else if (info.addedNodes[i].tagName === \"UL\") {\n              if (!this.__blockScrub) {\n                this.jos.scrubElementJOSData(info.addedNodes[i]);\n              }\n            }\n          }\n        }\n      }\n    }\n    setTimeout(() => {\n      this.__blockScrub = false;\n    }, 100);\n  }\n  /**\n   * Disconnected life cycle\n   */\n  disconnectedCallback() {\n    this.__outlineNode.removeEventListener(\n      \"keydown\",\n      this._onKeyDown.bind(this)\n    );\n    this._observer.disconnect();\n    super.disconnectedCallback();\n  }\n\n  /**\n   * Button events internally\n   */\n  buttonEvents(e) {\n    switch (e.target.id) {\n      case \"add\":\n        this._add(e);\n        break;\n      case \"collapse\":\n        this._collapse(e);\n        break;\n      case \"collapseall\":\n        this._collapseall(e);\n        break;\n      case \"expandall\":\n        this._expandall(e);\n        break;\n      case \"indent\":\n        this._indent();\n        break;\n      case \"outdent\":\n        this._outdent();\n        break;\n      case \"up\":\n        this._move(\"up\");\n        break;\n      case \"down\":\n        this._move(\"down\");\n        break;\n      case \"duplicate\":\n        this._duplicate();\n        break;\n    }\n  }\n  /**\n   * Duplicate whatever has selection\n   */\n  _duplicate() {\n    // get active item from where cursor is\n    try {\n      this.__blockScrub = false;\n      let activeItem = this.getSelectionNode();\n      if (activeItem && activeItem.tagName === \"LI\") {\n        // clone the item's hierarchy as well\n        if (\n          activeItem.nextElementSibling !== null &&\n          activeItem.nextElementSibling.tagName === \"UL\"\n        ) {\n          // copy the UL and all children and insert it after the UL it's duplicating\n          const clone2 = activeItem.nextElementSibling.cloneNode(true);\n          activeItem.parentNode.insertBefore(\n            clone2,\n            activeItem.nextElementSibling.nextElementSibling\n          );\n          // clone the LI, placing it before the UL we just made\n          const clone = activeItem.cloneNode(true);\n          activeItem.parentNode.insertBefore(\n            clone,\n            activeItem.nextElementSibling.nextElementSibling\n          );\n        } else {\n          const clone = activeItem.cloneNode(true);\n          // insert the clone AFTER the current selection\n          activeItem.parentNode.insertBefore(\n            clone,\n            activeItem.nextElementSibling\n          );\n        }\n      }\n    } catch (e) {\n      console.log(e);\n    }\n  }\n  /**\n   * Move whatever has selection up or down\n   */\n  _move(direction) {\n    // get active item from where cursor is\n    try {\n      let activeItem = this.getSelectionNode();\n      let test = activeItem;\n      let valid = false;\n      if (activeItem == null) {\n        return false;\n      }\n      // ensure this operation is executed in scope\n      while (!valid && test.parentNode) {\n        if (test.id === \"outline\") {\n          valid = true;\n        }\n        test = test.parentNode;\n      }\n      // ensure from all that, we have something\n      if (valid && activeItem && activeItem.tagName === \"LI\") {\n        // move the things above us, below us\n        if (direction === \"up\") {\n          // ensure there's something above us\n          if (activeItem.previousElementSibling !== null) {\n            // see if we are moving us, or us and the hierarchy\n            if (\n              activeItem.nextElementSibling &&\n              activeItem.nextElementSibling.tagName === \"UL\"\n            ) {\n              // see if the thing we have to move above has it's own structure\n              if (activeItem.previousElementSibling.tagName === \"UL\") {\n                // ensure we don't lose our metadata\n                this.__blockScrub = true;\n                // insert the element currently above us, just before 2 places back; so behind our UL\n                activeItem.parentNode.insertBefore(\n                  activeItem.previousElementSibling,\n                  activeItem.nextElementSibling.nextElementSibling\n                );\n              }\n              this.__blockScrub = true;\n              // now insert the LI above us, 2 places back so it is in front of the UL\n              activeItem.parentNode.insertBefore(\n                activeItem.previousElementSibling,\n                activeItem.nextElementSibling.nextElementSibling\n              );\n              activeItem.focus();\n            } else {\n              // easier use case, we are moving ourselves only but above us is a UL\n              if (activeItem.previousElementSibling.tagName === \"UL\") {\n                this.__blockScrub = true;\n                // move the UL after us\n                activeItem.parentNode.insertBefore(\n                  activeItem.previousElementSibling,\n                  activeItem.nextElementSibling\n                );\n              }\n              this.__blockScrub = true;\n              // now move the LI after us\n              activeItem.parentNode.insertBefore(\n                activeItem.previousElementSibling,\n                activeItem.nextElementSibling\n              );\n              activeItem.focus();\n            }\n          }\n        } else if (direction === \"down\") {\n          // if nothing after us, we can't move\n          if (activeItem.nextElementSibling !== null) {\n            // account for having to hop over children\n            if (\n              activeItem.nextElementSibling &&\n              activeItem.nextElementSibling.tagName === \"UL\" &&\n              activeItem.nextElementSibling.nextElementSibling !== null\n            ) {\n              // an outline is just below us\n              if (\n                activeItem.nextElementSibling.nextElementSibling.tagName ===\n                  \"LI\" &&\n                activeItem.nextElementSibling.nextElementSibling\n                  .nextElementSibling !== null &&\n                activeItem.nextElementSibling.nextElementSibling\n                  .nextElementSibling.tagName === \"UL\"\n              ) {\n                this.__blockScrub = true;\n                // move the thing 2 down to just before us; so the UL\n                activeItem.parentNode.insertBefore(\n                  activeItem.nextElementSibling.nextElementSibling,\n                  activeItem\n                );\n              }\n              this.__blockScrub = true;\n              // now move the LI that is 2 below us just above us\n              activeItem.parentNode.insertBefore(\n                activeItem.nextElementSibling.nextElementSibling,\n                activeItem\n              );\n              activeItem.focus();\n            } else if (activeItem.nextElementSibling.tagName === \"LI\") {\n              // just moving 1 tag, see if we need to move 2 things about us or 1\n              if (\n                activeItem.nextElementSibling.nextElementSibling !== null &&\n                activeItem.nextElementSibling.nextElementSibling.tagName ===\n                  \"UL\"\n              ) {\n                this.__blockScrub = true;\n                activeItem.parentNode.insertBefore(\n                  activeItem.nextElementSibling,\n                  activeItem\n                );\n              }\n              this.__blockScrub = true;\n              // work on the LI\n              activeItem.parentNode.insertBefore(\n                activeItem.nextElementSibling,\n                activeItem\n              );\n              activeItem.focus();\n            }\n          }\n        }\n      }\n    } catch (e) {\n      console.log(e);\n    }\n  }\n  /**\n   * Take the current manifest and import it into an HTML outline\n   */\n  importJsonOutlineSchemaItems() {\n    this.__blockScrub = true;\n    setTimeout(() => {\n      // wipe out the outline\n      while (this.__outlineNode.firstChild) {\n        this.__outlineNode.removeChild(this.__outlineNode.firstChild);\n      }\n      if (this.items.length === 0) {\n        // get from JOS items if we have none currently\n        this.items = [...this.jos.items];\n      }\n      let outline = this.jos.itemsToNodes(this.items);\n      // rebuild the outline w/ children we just found\n      while (outline.firstChild) {\n        this.__blockScrub = true;\n        this.__outlineNode.appendChild(outline.firstChild);\n      }\n      this.shadowRoot.querySelectorAll(\"li\").forEach(el => {\n        el.setAttribute(\"contenteditable\", \"true\");\n      });\n    }, 0);\n    return outline;\n  }\n  /**\n   * Take what's currently in the area and get JSON Outline Schema; optionally save\n   */\n  exportJsonOutlineSchemaItems(save = false) {\n    return this.jos.nodesToItems(this.__outlineNode, save);\n  }\n  _upPressed(e) {\n    let node = this.getSelectionNode();\n    if (node && node.previousSibling && node.previousSibling.tagName === \"LI\") {\n      node.previousSibling.focus();\n    } else if (\n      node &&\n      node.previousSibling &&\n      node.previousSibling.tagName === \"UL\" &&\n      node.previousSibling.firstChild &&\n      node.previousSibling.firstChild.tagName === \"LI\"\n    ) {\n      node.previousSibling.firstChild.focus();\n    } else if (\n      node &&\n      node.previousSibling == null &&\n      node.parentNode.tagName === \"UL\" &&\n      node.parentNode.previousSibling &&\n      node.parentNode.previousSibling.tagName === \"LI\"\n    ) {\n      node.parentNode.previousSibling.focus();\n    }\n  }\n  _downPressed(e) {\n    let node = this.getSelectionNode();\n    if (node && node.nextSibling && node.nextSibling.tagName === \"LI\") {\n      node.nextSibling.focus();\n    } else if (\n      node &&\n      node.nextSibling &&\n      node.nextSibling.tagName === \"UL\" &&\n      node.nextSibling.firstChild &&\n      node.nextSibling.firstChild.tagName === \"LI\"\n    ) {\n      node.nextSibling.firstChild.focus();\n    } else if (\n      node &&\n      node.nextSibling == null &&\n      node.parentNode.tagName === \"UL\" &&\n      node.parentNode.nextSibling &&\n      node.parentNode.nextSibling.tagName === \"LI\"\n    ) {\n      node.parentNode.nextSibling.focus();\n    }\n  }\n  /**\n   * Find the next thing to tab forward to.\n   */\n  _tabKeyPressed(e) {\n    e.preventDefault();\n    e.stopPropagation();\n    e.stopImmediatePropagation();\n    if (e.detail.keyboardEvent) {\n      e.detail.keyboardEvent.preventDefault();\n      e.detail.keyboardEvent.stopPropagation();\n      e.detail.keyboardEvent.stopImmediatePropagation();\n    }\n    try {\n      this._indent();\n    } catch (e) {}\n  }\n  /**\n   * Move back through things when tab back pressed\n   */\n  _tabBackKeyPressed(e) {\n    e.preventDefault();\n    e.stopPropagation();\n    e.stopImmediatePropagation();\n    if (e.detail.keyboardEvent) {\n      e.detail.keyboardEvent.preventDefault();\n      e.detail.keyboardEvent.stopPropagation();\n      e.detail.keyboardEvent.stopImmediatePropagation();\n    }\n    try {\n      this._outdent();\n    } catch (e) {}\n  }\n  _enterPressed(e) {\n    e.preventDefault();\n    e.stopPropagation();\n    e.stopImmediatePropagation();\n    // prevent the contenteditable stuff\n    if (e.detail.keyboardEvent) {\n      e.detail.keyboardEvent.preventDefault();\n      e.detail.keyboardEvent.stopPropagation();\n      e.detail.keyboardEvent.stopImmediatePropagation();\n    }\n    this._add();\n  }\n  _add() {\n    let li = document.createElement(\"li\");\n    li.setAttribute(\"contenteditable\", \"true\");\n    let node = this.getSelectionNode();\n    if (\n      this.__outlineNode.querySelector(\"li\") == null ||\n      !node ||\n      (node.tagName && (node.tagName != \"UL\" && node.tagName != \"LI\"))\n    ) {\n      this.__outlineNode.appendChild(li);\n    } else {\n      if ((node.tagName == null || node.tagName != \"LI\") && node.parentNode) {\n        node = node.parentNode;\n      }\n      if (node.nextSibling == null) {\n        node.parentNode.appendChild(li);\n      } else {\n        node.parentNode.insertBefore(li, node.nextSibling);\n      }\n      try {\n        li.focus();\n      } catch (e) {\n        // prevent issue on polyfill browsers potentially\n      }\n    }\n  }\n  _outdent() {\n    this.__blockScrub = true;\n    try {\n      let node = this.getSelectionNode();\n      if (node == null) {\n        return false;\n      }\n      // need to hold this in case it's empty at the end\n      const parent = node.parentNode;\n      if (\n        node.parentNode &&\n        node.parentNode != this.__outlineNode &&\n        node.parentNode.nextSibling != null\n      ) {\n        node.parentNode.parentNode.insertBefore(\n          node,\n          node.parentNode.nextSibling\n        );\n        if (parent.children.length == 0) {\n          parent.remove();\n        }\n      } else if (\n        node.parentNode &&\n        node.parentNode != this.__outlineNode &&\n        node.parentNode.nextSibling == null\n      ) {\n        node.parentNode.parentNode.appendChild(node);\n        if (parent.children.length == 0) {\n          parent.remove();\n        }\n      }\n      node.focus();\n    } catch (e) {\n      console.warn(e);\n    }\n  }\n  _indent() {\n    this.__blockScrub = true;\n    try {\n      let node = this.getSelectionNode();\n      if (node == null) {\n        return false;\n      }\n      // see if the previous tag is a LI, if so we can indent\n      if (\n        node.previousSibling != null &&\n        node.previousSibling.tagName === \"LI\"\n      ) {\n        let ul;\n        if (node.nextSibling && node.nextSibling.tagName === \"UL\") {\n          ul = node.nextSibling;\n        } else {\n          ul = document.createElement(\"ul\");\n          node.parentNode.insertBefore(ul, node);\n        }\n        // append a new list inside the child before the active node position\n        // now append into that list the node that was active\n        ul.appendChild(node);\n        node.focus();\n      } else if (\n        node.previousSibling != null &&\n        node.previousSibling.tagName === \"UL\"\n      ) {\n        node.previousSibling.appendChild(node);\n        node.focus();\n      }\n    } catch (e) {\n      console.warn(e);\n    }\n  }\n  getSelectionNode() {\n    let node = this.getDeepSelection().anchorNode;\n    if (\n      node &&\n      (node.tagName == null || node.tagName != \"LI\") &&\n      node.parentNode\n    ) {\n      node = node.parentNode;\n    }\n    return node;\n  }\n  /**\n   * Selection normalizer\n   */\n  getDeepSelection() {\n    // try and obtain the selection from the nearest shadow\n    // which would give us the selection object when running native ShadowDOM\n    // with fallback support for the entire window which would imply Shady\n    // native API\n    if (this.shadowRoot.getSelection) {\n      return this.shadowRoot.getSelection();\n    }\n    // ponyfill from google\n    else if (getRange(this.__outlineNode.parentNode)) {\n      return getRange(this.__outlineNode.parentNode);\n    }\n    // missed on both, hope the normal one will work\n    return window.getSelection();\n  }\n  /**\n   * Get a normalized range based on current selection\n   */\n  getDeepRange() {\n    let sel = this.getDeepSelection();\n    if (sel.getRangeAt && sel.rangeCount) {\n      return sel.getRangeAt(0);\n    } else if (sel) {\n      return sel;\n    } else false;\n  }\n}\nwindow.customElements.define(EditableOutline.tag, EditableOutline);\nexport { EditableOutline };\n"],"names":["EditableOutline","items","editMode","jos","window","JSONOutlineSchema","requestAvailability","setTimeout","addEventListener","_this","_collapseClickHandler","bind","LitElement","html","this","_enterPressed","_upPressed","_downPressed","buttonEvents","css","Array","Boolean","Object","e","node","getSelectionNode","tagName","nextElementSibling","classList","toggle","shadowRoot","querySelectorAll","forEach","el","remove","add","key","shiftKey","_tabBackKeyPressed","_tabKeyPressed","i","notFound","path","length","__outlineNode","querySelector","target","_this2","_onKeyDown","_observer","MutationObserver","_observeRecord","observe","childList","subtree","changedProperties","oldValue","propName","includes","eventName","replace","toLowerCase","_this3","dispatchEvent","CustomEvent","detail","value","record","index","info","addedNodes","__blockScrub","setAttribute","scrubElementJOSData","_this4","removeEventListener","disconnect","id","_add","_collapse","_collapseall","_expandall","_indent","_outdent","_move","_duplicate","activeItem","clone2","cloneNode","parentNode","insertBefore","clone","console","log","direction","test","valid","previousElementSibling","focus","_this5","firstChild","removeChild","outline","itemsToNodes","appendChild","save","nodesToItems","previousSibling","nextSibling","preventDefault","stopPropagation","stopImmediatePropagation","keyboardEvent","li","document","createElement","parent","children","warn","ul","getDeepSelection","anchorNode","getSelection","getRange","sel","getRangeAt","rangeCount","customElements","define","tag"],"mappings":"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"}