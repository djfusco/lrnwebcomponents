{"version":3,"file":"hal-9000.umd.js","sources":["hal-9000.umd.js"],"sourcesContent":["/**\n * Copyright 2019 The Pennsylvania State University\n * @license Apache-2.0, see License.md for full text.\n */\nimport { LitElement, html, css } from \"lit-element/lit-element.js\";\nimport \"@lrnwebcomponents/es-global-bridge/es-global-bridge.js\";\n/**\n * `hal-9000`\n * @element hal-9000\n * `Robot assistant tag, hopefully not evil`\n *\n\n * @demo demo/index.html\n */\nclass Hal9000 extends LitElement {\n  \n  //styles function\n  static get styles() {\n    return  [\n      \n      css`\n:host {\n  display: block;\n}\n      `\n    ];\n  }\n  // render function\n  render() {\n    return html`\n\n<slot></slot>`;\n  }\n\n  // properties available to the custom element for data binding\n    static get properties() {\n    return {\n  \n  ...super.properties,\n  \n  /**\n   * Commands to listen for and take action on\n   */\n  \"commands\": {\n    \"name\": \"commands\",\n    \"type\": Object\n  },\n  /**\n   * The name that HAL 9000 should respond to.\n   */\n  \"respondsTo\": {\n    \"name\": \"respondsTo\",\n    \"type\": String,\n    \"attribute\": \"responds-to\"\n  },\n  /**\n   * Debug mode for annyang\n   */\n  \"debug\": {\n    \"name\": \"debug\",\n    \"type\": Boolean\n  },\n  /**\n   * Start automatically\n   */\n  \"auto\": {\n    \"name\": \"auto\",\n    \"type\": Boolean,\n    \"reflect\": true\n  },\n  /**\n   * Status of listening\n   */\n  \"enabled\": {\n    \"name\": \"enabled\",\n    \"type\": Boolean,\n    \"reflect\": true\n  },\n  /**\n   * Pitch of speech\n   */\n  \"pitch\": {\n    \"name\": \"pitch\",\n    \"type\": Number,\n    \"reflect\": true\n  },\n  /**\n   * Rate of speech\n   */\n  \"rate\": {\n    \"name\": \"rate\",\n    \"type\": Number,\n    \"reflect\": true\n  },\n  /**\n   * Language of the speaker\n   */\n  \"language\": {\n    \"name\": \"language\",\n    \"type\": String,\n    \"reflect\": true\n  }\n}\n;\n  }\n\n  /**\n   * Store the tag name to make it easier to obtain directly.\n   * @notice function name must be here for tooling to operate correctly\n   */\n  static get tag() {\n    return \"hal-9000\";\n  }\n  // simple path from a url modifier\n  pathFromUrl(url) {\n    return url.substring(0, url.lastIndexOf(\"/\") + 1);\n  }\n  /**\n   * Establish the element\n   */\n  constructor() {\n    super();\n    this.commands = {};\n    this.respondsTo = \"(hal)\";\n    this.debug = false;\n    this.pitch = 0.9;\n    this.rate = 0.9;\n    this.language = \"en-US\";\n    // ensure singleton is set\n    window.Hal9000 = window.Hal9000 || {};\n    window.Hal9000.instance = this;\n    const basePath = this.pathFromUrl(decodeURIComponent(import.meta.url));\n    const location = `${basePath}lib/annyang/annyang.min.js`;\n    window.addEventListener(\n      \"es-bridge-annyang-loaded\",\n      this._annyangLoaded.bind(this)\n    );\n    window.ESGlobalBridge.requestAvailability();\n    window.ESGlobalBridge.instance.load(\"annyang\", location);\n    // check for speech synthesis API\n    if (typeof window.speechSynthesis !== \"undefined\") {\n      this.synth = window.speechSynthesis;\n      this.voices = this.synth.getVoices();\n      for (var i = 0; i < this.voices.length; i++) {\n        if (this.voices[i].default) {\n          this.defaultVoice = this.voices[i].name;\n        }\n      }\n    }\n  }\n  /**\n   * Callback for clicking on whatever was just said\n   */\n  clickObject(phrase) {\n    this.__text = phrase;\n    this.commands[phrase].object.click();\n    this.commands[phrase].object.focus();\n  }\n  /**\n   * Notice new voice commands added\n   */\n  _commandsChanged(newValue) {\n    this.addCommands(newValue);\n  }\n  /**\n   * Just rout add commands call to the right place\n   */\n  addCommands(commands) {\n    if (this.annyang) {\n      this.annyang.addCommands(commands);\n    }\n  }\n  /**\n   * And the word was good.\n   */\n  speak(text) {\n    this.__text = text;\n    if (this.synth) {\n      this.utter = new SpeechSynthesisUtterance(this.__text);\n      this.utter.pitch = this.pitch;\n      this.utter.rate = this.rate;\n      this.utter.lang = this.language;\n      this.utter.voice = this.defaultVoice;\n      // THOU SPEAKITH\n      this.synth.speak(this.utter);\n    } else {\n      console.warn(\"I have no voice...\");\n    }\n  }\n  /**\n   * Annyang library has been loaded globally so we can use it\n   */\n  _annyangLoaded() {\n    this.annyang = window.annyang;\n    // Add our commands to annyang\n    if (this.annyang) {\n      this.annyang.addCommands(this.commands);\n      this.annyang.debug(this.debug);\n      // Start listening. You can call this here, or attach this call to an event, button, etc.\n      if (this.auto) {\n        this.annyang.start({\n          autoRestart: true,\n          continuous: true\n        });\n      } else if (this.enabled) {\n        this.annyang.start();\n      }\n      // alert alert we are ready\n      const evt = new CustomEvent(\"hal-9000-online\", {\n        bubbles: true,\n        cancelable: false,\n        detail: true\n      });\n      this.dispatchEvent(evt);\n    }\n  }\n  /**\n   * Change the key name that is responded to\n   */\n  _respondsToChanged(newValue, oldValue) {\n    // remove all as our voice changed\n    if (this.annyang) {\n      this.annyang.removeCommands();\n    }\n    var commands = {};\n    for (var i in this.commands) {\n      if (i.replace(oldValue, newValue) !== i) {\n        commands[i.replace(oldValue, newValue)] = this.commands[i];\n      } else {\n        commands[i] = this.commands[i];\n      }\n    }\n    if (commands.length > 0) {\n      this.commands = { ...commands };\n    }\n  }\n  /**\n   * Notice auto state changed so we start listening\n   */\n  _autoChanged(newValue) {\n    this.enabled = newValue;\n  }\n  /**\n   * React to enabled state changing\n   */\n  _enabledChanged(newValue) {\n    if (this.annyang) {\n      if (newValue) {\n        if (this.auto) {\n          this.annyang.start({\n            autoRestart: true,\n            continuous: true\n          });\n        } else {\n          this.annyang.start();\n        }\n      } else {\n        this.annyang.abort();\n      }\n    }\n  }\n  /**\n   * debug mode changed\n   */\n  _debugChanged(newValue, oldValue) {\n    if (this.annyang) {\n      this.annyang.debug(newValue);\n    }\n  }\n  /**\n   * LitElement properties changed\n   */\n  updated(changedProperties) {\n    changedProperties.forEach((oldValue, propName) => {\n      if (propName == \"commands\") {\n        this._commandsChanged(this[propName], oldValue);\n      }\n      if (propName == \"respondsTo\") {\n        this._respondsToChanged(this[propName], oldValue);\n      }\n      if (propName == \"debug\") {\n        this._debugChanged(this[propName], oldValue);\n      }\n      if (propName == \"auto\") {\n        this._autoChanged(this[propName], oldValue);\n      }\n      if (propName == \"enabled\") {\n        this._enabledChanged(this[propName], oldValue);\n      }\n    });\n  }\n  /**\n   * life cycle, element is removed from the DOM\n   */\n  disconnectedCallback() {\n    window.removeEventListener(\n      \"es-bridge-annyang-loaded\",\n      this._annyangLoaded.bind(this)\n    );\n    super.disconnectedCallback();\n  }\n}\n// ensure we can generate a singleton\nwindow.customElements.define(Hal9000.tag, Hal9000);\nexport { Hal9000 };\nwindow.Hal9000 = window.Hal9000 || {};\n\nwindow.Hal9000.requestAvailability = () => {\n  if (!window.Hal9000.instance) {\n    window.Hal9000.instance = new Hal9000();\n  }\n};\n"],"names":["Hal9000","commands","respondsTo","debug","pitch","rate","language","window","instance","basePath","_this","pathFromUrl","decodeURIComponent","location","addEventListener","_annyangLoaded","bind","ESGlobalBridge","requestAvailability","load","speechSynthesis","synth","voices","getVoices","i","length","defaultVoice","name","LitElement","html","url","substring","lastIndexOf","css","Object","String","Boolean","Number","phrase","__text","object","click","focus","newValue","addCommands","this","annyang","text","utter","SpeechSynthesisUtterance","lang","voice","speak","console","warn","auto","start","autoRestart","continuous","enabled","evt","CustomEvent","bubbles","cancelable","detail","dispatchEvent","oldValue","removeCommands","replace","abort","changedProperties","forEach","propName","_this2","_commandsChanged","_respondsToChanged","_debugChanged","_autoChanged","_enabledChanged","removeEventListener","customElements","define","tag"],"mappings":"usEAcMA,4NA4GGC,SAAW,KACXC,WAAa,UACbC,OAAQ,IACRC,MAAQ,KACRC,KAAO,KACPC,SAAW,QAEhBC,OAAOP,QAAUO,OAAOP,SAAW,GACnCO,OAAOP,QAAQQ,kBACTC,EAAWC,EAAKC,YAAYC,oMAC5BC,YAAcJ,mCACpBF,OAAOO,iBACL,2BACAJ,EAAKK,eAAeC,YAEtBT,OAAOU,eAAeC,sBACtBX,OAAOU,eAAeT,SAASW,KAAK,UAAWN,QAET,IAA3BN,OAAOa,gBAAiC,GAC5CC,MAAQd,OAAOa,kBACfE,OAASZ,EAAKW,MAAME,gBACpB,IAAIC,EAAI,EAAGA,EAAId,EAAKY,OAAOG,OAAQD,IAClCd,EAAKY,OAAOE,eACTE,aAAehB,EAAKY,OAAOE,GAAGG,2PAnIvBC,yDAeXC,gDAqFGC,UACHA,EAAIC,UAAU,EAAGD,EAAIE,YAAY,KAAO,0CAjGvC,CAENC,+FAuBQ,MACF,gBACAC,mBAKI,MACJ,kBACAC,iBACK,qBAKN,MACC,aACAC,cAKF,MACE,YACAA,iBACG,WAKF,MACD,eACAA,iBACG,SAKJ,MACC,aACAC,gBACG,QAKL,MACE,YACAA,gBACG,YAKD,MACF,gBACAF,gBACG,uCAWJ,sDA0CGG,QACLC,OAASD,OACTrC,SAASqC,GAAQE,OAAOC,aACxBxC,SAASqC,GAAQE,OAAOE,iDAKdC,QACVC,YAAYD,uCAKP1C,GACN4C,KAAKC,cACFA,QAAQF,YAAY3C,iCAMvB8C,QACCR,OAASQ,EACVF,KAAKxB,YACF2B,MAAQ,IAAIC,yBAAyBJ,KAAKN,aAC1CS,MAAM5C,MAAQyC,KAAKzC,WACnB4C,MAAM3C,KAAOwC,KAAKxC,UAClB2C,MAAME,KAAOL,KAAKvC,cAClB0C,MAAMG,MAAQN,KAAKnB,kBAEnBL,MAAM+B,MAAMP,KAAKG,QAEtBK,QAAQC,KAAK,uEAOVR,QAAUvC,OAAOuC,QAElBD,KAAKC,QAAS,MACXA,QAAQF,YAAYC,KAAK5C,eACzB6C,QAAQ3C,MAAM0C,KAAK1C,OAEpB0C,KAAKU,UACFT,QAAQU,MAAM,CACjBC,aAAa,EACbC,YAAY,IAELb,KAAKc,cACTb,QAAQU,YAGTI,EAAM,IAAIC,YAAY,kBAAmB,CAC7CC,SAAS,EACTC,YAAY,EACZC,QAAQ,SAELC,cAAcL,+CAMJjB,EAAUuB,GAEvBrB,KAAKC,cACFA,QAAQqB,qBAEXlE,EAAW,OACV,IAAIuB,KAAKqB,KAAK5C,SACbuB,EAAE4C,QAAQF,EAAUvB,KAAcnB,EACpCvB,EAASuB,EAAE4C,QAAQF,EAAUvB,IAAaE,KAAK5C,SAASuB,GAExDvB,EAASuB,GAAKqB,KAAK5C,SAASuB,GAG5BvB,EAASwB,OAAS,SACfxB,cAAgBA,yCAMZ0C,QACNgB,QAAUhB,0CAKDA,GACVE,KAAKC,UACHH,EACEE,KAAKU,UACFT,QAAQU,MAAM,CACjBC,aAAa,EACbC,YAAY,SAGTZ,QAAQU,aAGVV,QAAQuB,+CAOL1B,EAAUuB,GAClBrB,KAAKC,cACFA,QAAQ3C,MAAMwC,mCAMf2B,cACNA,EAAkBC,QAAQ,SAACL,EAAUM,GACnB,YAAZA,GACFC,EAAKC,iBAAiBD,EAAKD,GAAWN,GAExB,cAAZM,GACFC,EAAKE,mBAAmBF,EAAKD,GAAWN,GAE1B,SAAZM,GACFC,EAAKG,cAAcH,EAAKD,GAAWN,GAErB,QAAZM,GACFC,EAAKI,aAAaJ,EAAKD,GAAWN,GAEpB,WAAZM,GACFC,EAAKK,gBAAgBL,EAAKD,GAAWN,oDAQzC3D,OAAOwE,oBACL,2BACAlC,KAAK9B,eAAeC,KAAK6B,yEAM/BtC,OAAOyE,eAAeC,OAAOjF,EAAQkF,IAAKlF,GAE1CO,OAAOP,QAAUO,OAAOP,SAAW,GAEnCO,OAAOP,QAAQkB,oBAAsB,WAC9BX,OAAOP,QAAQQ,WAClBD,OAAOP,QAAQQ,SAAW,IAAIR"}